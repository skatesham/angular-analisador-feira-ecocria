import{Ba as W,Ea as J,Fa as X,Ga as v,f as O,h as K,j as L,m as G,ua as H,va as y}from"./chunk-6JC4TW2Y.js";import{$ as h,Cb as B,Db as D,Ic as U,Kb as q,Lb as N,Mb as z,Nb as M,Pa as g,Pb as F,Qb as _,W as b,X as S,Xb as f,Yb as V,Z as A,Zb as j,cb as w,db as E,dc as P,gb as k,hb as $,ib as m,na as T,sa as C,vb as p,wb as I,wc as Q,xb as x,yb as R}from"./chunk-XGBSE7XG.js";var Y=`
    .p-tag {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: dt('tag.primary.background');
        color: dt('tag.primary.color');
        font-size: dt('tag.font.size');
        font-weight: dt('tag.font.weight');
        padding: dt('tag.padding');
        border-radius: dt('tag.border.radius');
        gap: dt('tag.gap');
    }

    .p-tag-icon {
        font-size: dt('tag.icon.size');
        width: dt('tag.icon.size');
        height: dt('tag.icon.size');
    }

    .p-tag-rounded {
        border-radius: dt('tag.rounded.border.radius');
    }

    .p-tag-success {
        background: dt('tag.success.background');
        color: dt('tag.success.color');
    }

    .p-tag-info {
        background: dt('tag.info.background');
        color: dt('tag.info.color');
    }

    .p-tag-warn {
        background: dt('tag.warn.background');
        color: dt('tag.warn.color');
    }

    .p-tag-danger {
        background: dt('tag.danger.background');
        color: dt('tag.danger.color');
    }

    .p-tag-secondary {
        background: dt('tag.secondary.background');
        color: dt('tag.secondary.color');
    }

    .p-tag-contrast {
        background: dt('tag.contrast.background');
        color: dt('tag.contrast.color');
    }
`;var ie=["icon"],re=["*"];function ne(o,c){if(o&1&&R(0,"span",4),o&2){let i=q(2);f(i.cx("icon")),p("ngClass",i.icon)("pBind",i.ptm("icon"))}}function oe(o,c){if(o&1&&(B(0),m(1,ne,1,4,"span",3),D()),o&2){let i=q();g(),p("ngIf",i.icon)}}function ce(o,c){}function se(o,c){o&1&&m(0,ce,0,0,"ng-template")}function de(o,c){if(o&1&&(I(0,"span",2),m(1,se,1,0,null,5),x()),o&2){let i=q();f(i.cx("icon")),p("pBind",i.ptm("icon")),g(),p("ngTemplateOutlet",i.iconTemplate||i._iconTemplate)}}var le={root:({instance:o})=>["p-tag p-component",{"p-tag-info":o.severity==="info","p-tag-success":o.severity==="success","p-tag-warn":o.severity==="warn","p-tag-danger":o.severity==="danger","p-tag-secondary":o.severity==="secondary","p-tag-contrast":o.severity==="contrast","p-tag-rounded":o.rounded}],icon:"p-tag-icon",label:"p-tag-label"},Z=(()=>{class o extends W{name="tag";style=Y;classes=le;static \u0275fac=(()=>{let i;return function(e){return(i||(i=C(o)))(e||o)}})();static \u0275prov=b({token:o,factory:o.\u0275fac})}return o})();var ee=new A("TAG_INSTANCE"),ue=(()=>{class o extends X{$pcTag=h(ee,{optional:!0,skipSelf:!0})??void 0;bindDirectiveInstance=h(v,{self:!0});onAfterViewChecked(){this.bindDirectiveInstance.setAttrs(this.ptms(["host","root"]))}styleClass;severity;value;icon;rounded;iconTemplate;templates;_iconTemplate;_componentStyle=h(Z);onAfterContentInit(){this.templates?.forEach(i=>{switch(i.getType()){case"icon":this._iconTemplate=i.template;break}})}static \u0275fac=(()=>{let i;return function(e){return(i||(i=C(o)))(e||o)}})();static \u0275cmp=w({type:o,selectors:[["p-tag"]],contentQueries:function(r,e,a){if(r&1&&(M(a,ie,4),M(a,H,4)),r&2){let n;F(n=_())&&(e.iconTemplate=n.first),F(n=_())&&(e.templates=n)}},hostVars:2,hostBindings:function(r,e){r&2&&f(e.cn(e.cx("root"),e.styleClass))},inputs:{styleClass:"styleClass",severity:"severity",value:"value",icon:"icon",rounded:[2,"rounded","rounded",U]},features:[P([Z,{provide:ee,useExisting:o},{provide:J,useExisting:o}]),$([v]),k],ngContentSelectors:re,decls:5,vars:6,consts:[[4,"ngIf"],[3,"class","pBind",4,"ngIf"],[3,"pBind"],[3,"class","ngClass","pBind",4,"ngIf"],[3,"ngClass","pBind"],[4,"ngTemplateOutlet"]],template:function(r,e){r&1&&(N(),z(0),m(1,oe,2,1,"ng-container",0)(2,de,2,4,"span",1),I(3,"span",2),V(4),x()),r&2&&(g(),p("ngIf",!e.iconTemplate&&!e._iconTemplate),g(),p("ngIf",e.iconTemplate||e._iconTemplate),g(),f(e.cx("label")),p("pBind",e.ptm("label")),g(),j(e.value))},dependencies:[G,O,K,L,y,v],encapsulation:2,changeDetection:0})}return o})(),we=(()=>{class o{static \u0275fac=function(r){return new(r||o)};static \u0275mod=E({type:o});static \u0275inj=S({imports:[ue,y,y]})}return o})();var ae=class o{vendas=T([]);filtros=T({});analiseCarregadaId=T(null);vendasFiltradas=Q(()=>{let c=this.vendas(),i=this.filtros();return c.filter(r=>{if(i.tempo&&(i.tempo.dataInicio&&r.data<i.tempo.dataInicio||i.tempo.dataFim&&r.data>i.tempo.dataFim)||i.categorias&&i.categorias.length>0&&!r.itens.some(a=>i.categorias.includes(a.categoria)||i.categorias.includes(a.tipo))||i.itens&&i.itens.length>0&&!r.itens.some(a=>i.itens.includes(a.nome)))return!1;if(i.buscaTexto){let e=i.buscaTexto.toLowerCase();if(!r.itens.some(n=>n.nome.toLowerCase().includes(e)||n.categoria.toLowerCase().includes(e)))return!1}return!0})});setVendas(c){this.vendas.set(c)}setFiltros(c){this.filtros.set(c)}setAnaliseCarregadaId(c){this.analiseCarregadaId.set(c)}getAnaliseCarregadaId(){return this.analiseCarregadaId()}calcularKPIs(){let c=this.vendasFiltradas(),i=c.reduce((t,d)=>t+d.valorTotal,0),e=new Set(c.map(t=>t.data.toISOString().split("T")[0])).size,a=e>0?i/e:0,n=c.reduce((t,d)=>t+d.itens.reduce((s,l)=>s+l.quantidade,0),0);return[{label:"Faturamento Total",valor:i,formato:"moeda",icone:"pi-dollar"},{label:"Feiras Registradas",valor:e,formato:"numero",icone:"pi-calendar"},{label:"Ticket M\xE9dio por Feira",valor:a,formato:"moeda",icone:"pi-chart-line"},{label:"Itens Vendidos",valor:n,formato:"numero",icone:"pi-shopping-cart"}]}calcularItensVendidos(){let c=this.vendasFiltradas(),i=new Map;c.forEach(e=>{e.itens.forEach(a=>{let n=a.nome,t=i.get(n);t?(t.quantidade+=a.quantidade,t.receita+=a.valorTotal,a.precoUnitario&&t.precos.push(a.precoUnitario),t.frequencia++):i.set(n,{categoria:a.tipo||a.categoria,quantidade:a.quantidade,receita:a.valorTotal,precos:a.precoUnitario?[a.precoUnitario]:[],frequencia:1})})});let r=Array.from(i.values()).reduce((e,a)=>e+a.receita,0);return Array.from(i.entries()).map(([e,a])=>({nome:e,categoria:a.categoria,quantidade:a.quantidade,receita:a.receita,participacao:r>0?a.receita/r*100:0,precoMedio:a.precos.length>0?a.precos.reduce((n,t)=>n+t,0)/a.precos.length:0,frequencia:a.frequencia})).sort((e,a)=>a.receita-e.receita)}calcularCategorias(){let c=this.vendasFiltradas(),i=new Map;c.forEach(e=>{e.itens.forEach(a=>{let n=i.get(a.categoria);n?(n.receita+=a.valorTotal,n.quantidade+=a.quantidade,n.itens.add(a.nome)):i.set(a.categoria,{receita:a.valorTotal,quantidade:a.quantidade,itens:new Set([a.nome])})})});let r=Array.from(i.values()).reduce((e,a)=>e+a.receita,0);return Array.from(i.entries()).map(([e,a])=>({nome:e,receita:a.receita,quantidade:a.quantidade,participacao:r>0?a.receita/r*100:0,itens:a.itens.size})).sort((e,a)=>a.receita-e.receita)}calcularEvolucaoTemporal(c="semana"){let i=this.vendasFiltradas(),r=new Map;return i.forEach(e=>{let a=c==="semana"?`${e.ano}-W${e.semana.toString().padStart(2,"0")}`:`${e.ano}-${(e.data.getMonth()+1).toString().padStart(2,"0")}`,n=r.get(a),t=e.itens.reduce((d,s)=>d+s.quantidade,0);n?(n.receita+=e.valorTotal,n.quantidade+=t,n.feiras.add(`${e.ano}-${e.semana}`)):r.set(a,{data:e.data,receita:e.valorTotal,quantidade:t,feiras:new Set([`${e.ano}-${e.semana}`])})}),Array.from(r.entries()).map(([e,a])=>({periodo:e,data:a.data,receita:a.receita,quantidade:a.quantidade,ticketMedio:a.feiras.size>0?a.receita/a.feiras.size:0,feiras:a.feiras.size})).sort((e,a)=>e.data.getTime()-a.data.getTime())}gerarInsights(){let c=[];if(this.vendasFiltradas().length===0)return c;let r=this.calcularTopCategorias(5),e=this.calcularTopSubcategorias(10),a=this.calcularEvolucaoPorData();if(r.length>0&&r[0].participacao>30&&c.push({tipo:"oportunidade",titulo:`${r[0].nome} \xE9 sua categoria campe\xE3`,descricao:`Representa ${r[0].participacao.toFixed(1)}% da receita total (R$ ${r[0].receita.toFixed(2)})`,metrica:"categoria_campea",valor:r[0].participacao,explicacao:"Mantenha variedade e estoque adequado nesta categoria",prioridade:"alta"}),e.length>0){let n=e[0];c.push({tipo:"oportunidade",titulo:`${n.nome} lidera as subcategorias`,descricao:`${n.quantidade} unidades vendidas, gerando R$ ${n.receita.toFixed(2)}`,metrica:"subcategoria_top",valor:n.receita,explicacao:"Considere aumentar produ\xE7\xE3o ou criar varia\xE7\xF5es",prioridade:"alta"})}if(r.length>0&&r[0].participacao>50&&c.push({tipo:"alerta",titulo:"Concentra\xE7\xE3o alta em uma categoria",descricao:`${r[0].nome} representa mais de 50% da receita`,metrica:"concentracao_categoria",valor:r[0].participacao,explicacao:"Risco: depend\xEAncia excessiva. Diversifique o portf\xF3lio",prioridade:"media"}),a.length>=3){let n=a.slice(-3),t=n[0].receita,s=(n[n.length-1].receita-t)/t*100;s>10?c.push({tipo:"oportunidade",titulo:"Vendas em crescimento",descricao:`Crescimento de ${s.toFixed(1)}% nas \xFAltimas ${n.length} feiras`,metrica:"crescimento",valor:s,explicacao:"Tend\xEAncia positiva. Mantenha o ritmo de produ\xE7\xE3o",prioridade:"alta"}):s<-10&&c.push({tipo:"alerta",titulo:"Queda nas vendas",descricao:`Redu\xE7\xE3o de ${Math.abs(s).toFixed(1)}% nas \xFAltimas ${n.length} feiras`,metrica:"queda",valor:s,explicacao:"Revise estrat\xE9gia de produtos e precifica\xE7\xE3o",prioridade:"alta"})}if(r.length>=3){let n=r.slice(0,3).reduce((t,d)=>t+d.participacao,0);n<70&&c.push({tipo:"oportunidade",titulo:"Portf\xF3lio bem diversificado",descricao:`Top 3 categorias representam ${n.toFixed(1)}% da receita`,metrica:"diversificacao",valor:n,explicacao:"Boa distribui\xE7\xE3o reduz riscos de mercado",prioridade:"baixa"})}return c.slice(0,5)}calcularTopCategorias(c=5){let i=this.vendasFiltradas(),r=new Map;i.forEach(n=>{n.itens.forEach(t=>{let d=t.tipo||"Sem Categoria",s=t.categoria||"",l=r.get(d);if(l){if(l.receita+=t.valorTotal,l.quantidade+=t.quantidade,s){let u=l.subcategorias.get(s);u?(u.receita+=t.valorTotal,u.quantidade+=t.quantidade):l.subcategorias.set(s,{receita:t.valorTotal,quantidade:t.quantidade})}}else{let u=new Map;s&&u.set(s,{receita:t.valorTotal,quantidade:t.quantidade}),r.set(d,{receita:t.valorTotal,quantidade:t.quantidade,subcategorias:u})}})});let e=Array.from(r.values()).reduce((n,t)=>n+t.receita,0);return Array.from(r.entries()).map(([n,t])=>{let d=Array.from(t.subcategorias.entries()).map(([s,l])=>({nome:s,categoria:n,receita:l.receita,quantidade:l.quantidade,participacao:e>0?l.receita/e*100:0,precoMedio:l.quantidade>0?l.receita/l.quantidade:0,frequencia:0,tendencia:"estavel",variacao:0}));return{nome:n,subcategorias:d,receita:t.receita,quantidade:t.quantidade,participacao:e>0?t.receita/e*100:0,tendencia:"estavel",variacao:0,itens:t.subcategorias.size}}).sort((n,t)=>t.receita-n.receita).slice(0,c)}calcularTopSubcategorias(c=10){let i=this.vendasFiltradas(),r=new Map;i.forEach(n=>{n.itens.forEach(t=>{if(!t.tipo||!t.categoria)return;let d=t.categoria,s=t.tipo,l=`${s}::${d}`,u=r.get(l);u?(u.receita+=t.valorTotal,u.quantidade+=t.quantidade,u.frequencia++):r.set(l,{categoria:s,receita:t.valorTotal,quantidade:t.quantidade,frequencia:1})})});let e=Array.from(r.values()).reduce((n,t)=>n+t.receita,0);return Array.from(r.entries()).map(([n,t])=>{let[d,s]=n.split("::");return{nome:s,categoria:d,receita:t.receita,quantidade:t.quantidade,participacao:e>0?t.receita/e*100:0,precoMedio:t.quantidade>0?t.receita/t.quantidade:0,frequencia:t.frequencia,tendencia:"estavel",variacao:0}}).sort((n,t)=>t.receita-n.receita).slice(0,c)}calcularEvolucaoPorData(){let c=this.vendasFiltradas(),i=new Map;return c.forEach(r=>{let e=r.data.toISOString().split("T")[0],a=r.itens.reduce((t,d)=>t+d.quantidade,0),n=i.get(e);n?(n.receita+=r.valorTotal,n.quantidade+=a):i.set(e,{receita:r.valorTotal,quantidade:a})}),Array.from(i.entries()).map(([r,e])=>({data:r,receita:e.receita,quantidade:e.quantidade})).sort((r,e)=>r.data.localeCompare(e.data))}static \u0275fac=function(i){return new(i||o)};static \u0275prov=b({token:o,factory:o.\u0275fac,providedIn:"root"})};export{ue as a,we as b,ae as c};
